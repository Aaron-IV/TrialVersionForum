<!doctype html>
<html lang="en">
  <head>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Forum Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/forum.css?v=4" rel="stylesheet">
    <script src="/static/reactions.js"></script>
    <script src="/static/backtotop.js"></script>
  </head>
  <body>
    <header class="blog-header py-3">
      <div class="container">
        <div class="row flex-nowrap justify-content-between align-items-center">
          <div class="col-4 pt-1">
            {{if .User}}
              <span style="color: #767676; font-weight: 500;">Welcome, {{.User.Username}}</span>
            {{else}}
              <a class="link-secondary" href="/login" style="color: #767676; text-decoration: none; font-weight: 500;">Login</a> |
              <a class="link-secondary" href="/register" style="color: #767676; text-decoration: none; font-weight: 500;">Register</a>
            {{end}}
          </div>
          <div class="col-4 text-center">
            <a class="blog-header-logo" href="/">Forum</a>
          </div>
          <div class="col-4 d-flex justify-content-end align-items-center">
            {{if .User}}
              <a class="btn btn-sm btn-outline-secondary" href="/logout" style="border-color: #e1e1e1; color: #767676;">Logout</a>
            {{end}}
          </div>
        </div>
      </div>
    </header>
    
    <div class="nav-scroller py-1 mb-2">
      <div class="container">
        <nav class="nav d-flex justify-content-center">
          {{range .Categories}}
            <a class="nav-link" href="/?category={{.ID}}">{{.Name}}</a>
          {{end}}
        </nav>
      </div>
    </div>

    <main class="container">
      <div class="row">
        <div class="col-lg-9">
          {{if .User}}
          <div class="filters-bar" style="display: flex; gap: .5rem; flex-wrap: wrap; align-items: center; margin-bottom: 1rem;">
            <span style="color:#555;font-weight:600;margin-right:.25rem;">Filters:</span>
            <a class="badge" href="/">All</a>
            <a class="badge" href="/?filter=myposts">My Posts</a>
            <a class="badge" href="/?filter=liked">Liked</a>
            <a class="badge" href="/?filter=disliked">Disliked</a>
            <a class="badge" href="/?filter=most_liked">Most Liked</a>
            <a class="badge" href="/?filter=most_commented">Most Commented</a>
          </div>
          {{end}}
          <!-- Pinterest-style grid -->
          <div class="pinterest-grid">
            {{range .Posts}}
              <div class="pinterest-card" id="post{{.ID}}">
                <div class="pinterest-card-content">
                  <div class="pinterest-card-header">
                    <a href="/post/{{.ID}}" class="pinterest-card-title">{{.Title}}</a>
                    <div class="pinterest-card-meta">
                      {{.CreatedAt | formatDateTime}} by {{.Author}}
                      <span style="margin-left: 0.5rem; color: #999;">‚Ä¢</span>
                      <span style="margin-left: 0.5rem;">{{.CommentCount}} comments</span>
                    </div>
                  </div>
                  
                  <div class="pinterest-card-content-text">
                    {{.Content | trimContent}}
                  </div>
                  
                  {{if .Categories}}
                    <div class="pinterest-card-categories">
                      {{range .Categories}}
                        <a href="/?category={{.ID}}" class="badge">{{.Name}}</a>
                      {{end}}
                    </div>
                  {{end}}
                  
                  <div class="pinterest-card-actions">
                    <a href="#" data-type="post" data-id="{{.ID}}" data-like="1" class="pinterest-btn pinterest-btn-like reaction-btn">
                      ‚ù§Ô∏è <span class="likes-count">{{.Likes}}</span>
                    </a>
                    <a href="#" data-type="post" data-id="{{.ID}}" data-like="0" class="pinterest-btn pinterest-btn-dislike reaction-btn">
                      üëé <span class="dislikes-count">{{.Dislikes}}</span>
                    </a>
                    {{if and $.User (eq $.User.ID .UserID)}}
                      <a href="/edit_post?id={{.ID}}" class="pinterest-btn pinterest-btn-edit">Edit</a>
                      <form method="POST" action="/delete_post?id={{.ID}}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this post?');">
                        <input type="hidden" name="_method" value="DELETE">
                        <button type="submit" class="pinterest-btn pinterest-btn-delete">Delete</button>
                      </form>
                    {{end}}
                  </div>
                </div>
              </div>
            {{else}}
              <div class="pinterest-card">
                <div class="pinterest-card-content text-center">
                  <h3 style="color: #767676; margin-bottom: 1rem;">No posts yet</h3>
                  <p style="color: #999;">Be the first to create a post!</p>
                </div>
              </div>
            {{end}}
          </div>

          {{if gt .TotalPages 1}}
          <nav aria-label="Page navigation">
            <ul class="pagination">
              <li class="page-item {{if eq .Page 1}}disabled{{end}}">
                <a class="page-link" href="{{paginationURL (dec .Page) .CurrentCategoryID .CurrentFilter}}" tabindex="-1">Previous</a>
              </li>
              {{range $i := iterate .TotalPages}}
                <li class="page-item {{if eq $.Page (add $i 1)}}active{{end}}">
                  <a class="page-link" href="{{paginationURL (add $i 1) $.CurrentCategoryID $.CurrentFilter}}">{{add $i 1}}</a>
                </li>
              {{end}}
              <li class="page-item {{if eq .Page .TotalPages}}disabled{{end}}">
                <a class="page-link" href="{{paginationURL (inc .Page) .CurrentCategoryID .CurrentFilter}}">Next</a>
              </li>
            </ul>
          </nav>
          {{end}}
        </div>
        
        <div class="col-lg-3"></div>
      </div>
    </main>

    {{if .User}}
      <a href="/create_post" class="create-post-btn">
        ‚ûï Create Post
      </a>
    {{end}}

    <footer class="blog-footer">
      <a href="#top" id="back-to-top">‚Üë Back to top</a>
    </footer>
  </body>
</html>